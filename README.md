# PDFTools

A comprehensive Python toolkit for PDF processing with multiple OCR backends, including API-based and local model inference options.

## Features

- **Mistral OCR API Integration** - High-quality OCR using Mistral's latest vision model
- **Local OCR Processing** - Lightweight OCR using Qwen2-VL and olmOCR models
- **Web UI Viewer** - Streamlit-based interface for viewing and exploring OCR results
- **Retry Logic** - Built-in exponential backoff for resilient API calls
- **Batch Processing** - Process multiple PDFs efficiently
- **Image Extraction** - Automatically extract and preserve images from PDFs
- **Markdown Output** - Convert PDF content to clean, structured markdown

## Prerequisites

- Python 3.8 or higher
- API key for Mistral (if using Mistral OCR)
- Optional: NVIDIA GPU (for faster local model inference)

## Installation

### 1. Clone the repository

```bash
git clone https://github.com/csv610/OCRTools.git
cd OCRTools
```

### 2. Create and activate a virtual environment

```bash
# macOS/Linux
python3 -m venv venv
source venv/bin/activate

# Windows
python -m venv venv
venv\Scripts\activate
```

### 3. Install dependencies

```bash
pip install -r requirements.txt
```

### 4. Configure environment variables

Create a `.env` file in the project root:

```bash
MISTRAL_API_KEY=your_api_key_here
```

Or set the environment variable:

```bash
export MISTRAL_API_KEY=your_api_key_here
```

## Usage

### Mistral OCR (API-based)

Process a PDF using the Mistral OCR API:

```bash
cd ocr
python mistral_ocr.py path/to/your/document.pdf
```

This will:
1. Convert the PDF to base64 format
2. Send it to Mistral's OCR API
3. Extract text as markdown
4. Save images to the output directory
5. Generate a `results.zip` file containing all outputs

**Command-line options:**

```bash
python mistral_ocr.py input.pdf [--output-dir ./output] [--max-retries 3] [--timeout 300]
```

### Local OCR (Experimental)

Process a PDF using local vision models (requires significant GPU memory):

```bash
cd ocr
python olma_ocr.py
```

> ‚ö†Ô∏è **Note:** This is an experimental implementation. Ensure you have sufficient VRAM (16GB+ recommended).

### Web Viewer

Start the Streamlit web interface to view OCR results:

```bash
cd ocr
streamlit run sl_mdviewer.py
```

Then:
1. Upload a ZIP file containing markdown and images (generated by mistral_ocr.py)
2. View the rendered markdown with embedded images in your browser

## Project Structure

```
PDFTools/
‚îú‚îÄ‚îÄ ocr/
‚îÇ   ‚îú‚îÄ‚îÄ mistral_ocr.py       # Mistral API OCR implementation
‚îÇ   ‚îú‚îÄ‚îÄ olma_ocr.py          # Local model OCR (experimental)
‚îÇ   ‚îî‚îÄ‚îÄ sl_mdviewer.py       # Streamlit web viewer
‚îú‚îÄ‚îÄ requirements.txt          # Project dependencies
‚îú‚îÄ‚îÄ README.md                 # This file
‚îú‚îÄ‚îÄ LICENSE                   # MIT License
‚îî‚îÄ‚îÄ .gitignore               # Git ignore rules
```

## Dependencies

| Package | Purpose |
|---------|---------|
| `mistralai` | Mistral API client |
| `tenacity` | Retry logic with exponential backoff |
| `streamlit` | Web UI framework |
| `watchdog` | File system monitoring |
| `torch` | PyTorch (for local models) |
| `transformers` | Hugging Face transformers (for local models) |
| `Pillow` | Image processing |

## API Reference

### MistralOCR Class

Main class for handling PDF OCR operations via Mistral API.

```python
from ocr.mistral_ocr import MistralOCR

ocr = MistralOCR(api_key="your_key")
result = ocr.process_pdf("document.pdf", output_dir="./output")
```

#### Methods

- `process_pdf(pdf_path, output_dir)` - Process a PDF file and return results
- `validate_pdf(pdf_path)` - Validate PDF file before processing
- `encode_pdf_to_base64(pdf_path)` - Encode PDF as base64 string
- `extract_content_from_response(response)` - Parse API response

### Streamlit Viewer

Simple web interface for viewing OCR results.

```bash
streamlit run ocr/sl_mdviewer.py
```

Accepts ZIP files with structure:
```
results.zip
‚îú‚îÄ‚îÄ markdown.md
‚îî‚îÄ‚îÄ images/
    ‚îú‚îÄ‚îÄ image_1.png
    ‚îú‚îÄ‚îÄ image_2.png
    ‚îî‚îÄ‚îÄ ...
```

## Configuration

### Environment Variables

| Variable | Description | Required |
|----------|-------------|----------|
| `MISTRAL_API_KEY` | Your Mistral API key | Yes (for mistral_ocr.py) |
| `MISTRAL_OCR_MODEL` | Model ID (default: mistral-ocr-latest) | No |
| `MISTRAL_API_TIMEOUT` | API timeout in seconds (default: 300) | No |

### Logging

Logs are written to `mistral_ocr.log` by default. Configure logging in the script:

```python
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('custom.log'),
        logging.StreamHandler()
    ]
)
```

## Troubleshooting

### API Key Not Found

```
Error: Mistral API key not found in environment
```

**Solution:** Set `MISTRAL_API_KEY` environment variable:
```bash
export MISTRAL_API_KEY=your_key_here
```

### PDF Processing Fails

- Verify the PDF file is readable and not corrupted
- Check file permissions: `chmod 644 your_pdf.pdf`
- Increase timeout: `python mistral_ocr.py input.pdf --timeout 600`

### Streamlit Port Already in Use

```bash
streamlit run ocr/sl_mdviewer.py --server.port 8502
```

### GPU Memory Issues (Local OCR)

Reduce batch size or use CPU-only mode. Edit `olma_ocr.py`:

```python
device = "cpu"  # Instead of "cuda"
```

## Performance Tips

1. **Batch Processing**: Process multiple PDFs in sequence to avoid memory issues
2. **API Rate Limiting**: Mistral API may have rate limits; implement delays between requests
3. **Local Models**: GPU inference is 5-10x faster than CPU; ensure CUDA is properly installed
4. **Output Optimization**: Resize extracted images to reduce file size

## Contributing

We welcome contributions! Please see [CONTRIBUTING.md](CONTRIBUTING.md) for guidelines.

## License

This project is licensed under the MIT License - see [LICENSE](LICENSE) file for details.

## Support

- üìñ **Documentation**: See examples and detailed docs in the README
- üêõ **Issues**: Report bugs on [GitHub Issues](https://github.com/csv610/OCRTools/issues)
- üí¨ **Discussions**: Start a discussion for questions and feature requests

## Roadmap

- [ ] Support for additional OCR models (Google Vision, Azure Computer Vision)
- [ ] Batch processing with progress tracking
- [ ] Docker containerization
- [ ] API server mode for REST endpoints
- [ ] Support for multi-language OCR
- [ ] Performance benchmarking suite
- [ ] Unit and integration tests

## Acknowledgments

- [Mistral AI](https://mistral.ai/) for their OCR API
- [Streamlit](https://streamlit.io/) for the web framework
- [Hugging Face](https://huggingface.co/) for transformer models

---

**Last updated:** 2024 | **Version:** 1.0.0
